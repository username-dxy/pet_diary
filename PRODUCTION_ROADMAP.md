# Pet Diary ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è·¯çº¿å›¾

## å½“å‰çŠ¶æ€è¯„ä¼°

### âœ… å·²å®Œæˆï¼ˆå¯ç”¨äºMVPï¼‰
- æœ¬åœ°ç…§ç‰‡æŒä¹…åŒ–å­˜å‚¨
- ç¦»çº¿ä¼˜å…ˆæ¶æ„
- Profileæ•°æ®ç®¡ç†
- æ—¥è®°ç”Ÿæˆé€»è¾‘
- MockæœåŠ¡å±‚

### âš ï¸ ç”Ÿäº§ç¯å¢ƒå¿…é¡»æ”¹è¿›
- äº‘ç«¯å¤‡ä»½ä¸åŒæ­¥
- ç”¨æˆ·è´¦å·ç³»ç»Ÿ
- æ•°æ®åŠ å¯†
- æ€§èƒ½ç›‘æ§
- å´©æºƒä¸ŠæŠ¥

## æ¸è¿›å¼éƒ¨ç½²è®¡åˆ’

### Phase 1: æœ¬åœ°æµ‹è¯•ï¼ˆå½“å‰é˜¶æ®µï¼‰âœ…

**ç›®æ ‡**: éªŒè¯æ ¸å¿ƒåŠŸèƒ½é€»è¾‘

**æŠ€æœ¯æ ˆ**:
- æœ¬åœ°å­˜å‚¨: SharedPreferences + åº”ç”¨æ–‡æ¡£ç›®å½•
- MockæœåŠ¡: MockProfileService
- æµ‹è¯•å·¥å…·: Flutter Test + æ‰‹åŠ¨æµ‹è¯•

**é€‚ç”¨åœºæ™¯**:
- âœ… åŠŸèƒ½å¼€å‘å’Œæµ‹è¯•
- âœ… UI/UXéªŒè¯
- âœ… æ¼”ç¤ºDemo
- âŒ ä¸é€‚åˆçœŸå®ç”¨æˆ·ä½¿ç”¨

---

### Phase 2: æœ¬åœ°æœåŠ¡ç«¯æµ‹è¯•ï¼ˆæ¨èä¸‹ä¸€æ­¥ï¼‰

**ç›®æ ‡**: æµ‹è¯•å®Œæ•´çš„ç½‘ç»œäº¤äº’æµç¨‹

#### é€‰é¡¹2.1: JSON Serverï¼ˆæœ€ç®€å•ï¼‰â­

**å®‰è£…**:
```bash
npm install -g json-server
```

**åˆ›å»ºMock API**:
```bash
# åˆ›å»ºæ•°æ®æ–‡ä»¶
mkdir -p mock-server
cat > mock-server/db.json << 'EOF'
{
  "pets": [],
  "photos": [],
  "diaries": [],
  "users": []
}
EOF

# å¯åŠ¨æœåŠ¡
json-server --watch mock-server/db.json --port 3000
```

**APIç«¯ç‚¹è‡ªåŠ¨ç”Ÿæˆ**:
- GET/POST /pets
- GET/POST /photos
- GET/POST /diaries
- æ”¯æŒåˆ†é¡µã€æ’åºã€è¿‡æ»¤

**ä¼˜ç‚¹**:
- âœ… é›¶ä»£ç é…ç½®
- âœ… RESTful APIæ ‡å‡†
- âœ… æ”¯æŒæ–‡ä»¶ä¸Šä¼ ï¼ˆéœ€ä¸­é—´ä»¶ï¼‰
- âœ… å¿«é€ŸåŸå‹éªŒè¯

**ç¼ºç‚¹**:
- âŒ æ— è®¤è¯æˆæƒ
- âŒ æ— å¤æ‚ä¸šåŠ¡é€»è¾‘
- âŒ ä¸æ”¯æŒæ–‡ä»¶å­˜å‚¨ï¼ˆéœ€é¢å¤–é…ç½®ï¼‰

#### é€‰é¡¹2.2: Express.js æœåŠ¡å™¨ï¼ˆæ¨èï¼‰â­â­â­

**é¡¹ç›®ç»“æ„**:
```
mock-server/
â”œâ”€â”€ server.js          # ä¸»æœåŠ¡
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ auth.js       # è®¤è¯è·¯ç”±
â”‚   â”œâ”€â”€ pets.js       # å® ç‰©ç®¡ç†
â”‚   â”œâ”€â”€ photos.js     # ç…§ç‰‡ä¸Šä¼ 
â”‚   â””â”€â”€ diaries.js    # æ—¥è®°CRUD
â”œâ”€â”€ uploads/          # ç…§ç‰‡å­˜å‚¨ç›®å½•
â””â”€â”€ db.json           # ç®€å•æ•°æ®å­˜å‚¨
```

**åˆ›å»ºæœåŠ¡å™¨**:
```bash
mkdir -p mock-server && cd mock-server
npm init -y
npm install express multer cors body-parser uuid
```

**ä¼˜ç‚¹**:
- âœ… å®Œå…¨æ§åˆ¶ä¸šåŠ¡é€»è¾‘
- âœ… æ”¯æŒæ–‡ä»¶ä¸Šä¼ 
- âœ… å¯æ·»åŠ è®¤è¯ä¸­é—´ä»¶
- âœ… æ¥è¿‘çœŸå®ç”Ÿäº§ç¯å¢ƒ

#### é€‰é¡¹2.3: Firebaseï¼ˆå¿«é€Ÿä¸Šçº¿ï¼‰â­â­â­â­

**åŠŸèƒ½**:
- Authentication: é‚®ç®±/ç¤¾äº¤ç™»å½•
- Cloud Firestore: NoSQLæ•°æ®åº“
- Cloud Storage: ç…§ç‰‡å­˜å‚¨
- Cloud Functions: æœåŠ¡ç«¯é€»è¾‘

**ä¼˜ç‚¹**:
- âœ… å…è´¹é¢åº¦å……è¶³
- âœ… è‡ªåŠ¨æ‰©å±•
- âœ… å®æ—¶åŒæ­¥
- âœ… SDKå®Œå–„

**ç¼ºç‚¹**:
- âŒ å‚å•†é”å®š
- âŒ å›½å†…è®¿é—®æ…¢ï¼ˆéœ€ä»£ç†ï¼‰

---

### Phase 3: äº‘æœåŠ¡é›†æˆï¼ˆç”Ÿäº§å°±ç»ªï¼‰

**å¿…éœ€ç»„ä»¶**:

#### 3.1 åç«¯æœåŠ¡

**æŠ€æœ¯é€‰å‹**:
- **Node.js + Express** (æ¨è)
- **Python + FastAPI**
- **Go + Gin**

**æ ¸å¿ƒåŠŸèƒ½**:
```
ç”¨æˆ·æœåŠ¡:
â”œâ”€â”€ æ³¨å†Œ/ç™»å½• (JWTè®¤è¯)
â”œâ”€â”€ å¯†ç é‡ç½®
â””â”€â”€ è´¦å·ç®¡ç†

å® ç‰©æœåŠ¡:
â”œâ”€â”€ CRUDæ“ä½œ
â”œâ”€â”€ å¤šå® ç‰©æ”¯æŒ
â””â”€â”€ æ•°æ®åŒæ­¥

ç…§ç‰‡æœåŠ¡:
â”œâ”€â”€ ä¸Šä¼ åˆ°OSS (é˜¿é‡Œäº‘/ä¸ƒç‰›/AWS S3)
â”œâ”€â”€ ç¼©ç•¥å›¾ç”Ÿæˆ
â”œâ”€â”€ CDNåŠ é€Ÿ
â””â”€â”€ æ™ºèƒ½å‹ç¼©

æ—¥è®°æœåŠ¡:
â”œâ”€â”€ AIç”Ÿæˆï¼ˆè°ƒç”¨OpenAI/Claude APIï¼‰
â”œâ”€â”€ å†å²è®°å½•
â””â”€â”€ å¯¼å‡ºåŠŸèƒ½
```

#### 3.2 äº‘å­˜å‚¨

**OSSæ–¹æ¡ˆå¯¹æ¯”**:

| æœåŠ¡å•† | å›½å†…é€Ÿåº¦ | ä»·æ ¼ | CDN | æ¨èåº¦ |
|--------|---------|------|-----|--------|
| é˜¿é‡Œäº‘OSS | â­â­â­â­â­ | Â¥0.12/GB | âœ… | â­â­â­â­â­ |
| ä¸ƒç‰›äº‘ | â­â­â­â­ | Â¥0.14/GB | âœ… | â­â­â­â­ |
| è…¾è®¯äº‘COS | â­â­â­â­ | Â¥0.13/GB | âœ… | â­â­â­â­ |
| AWS S3 | â­â­â­ | $0.023/GB | âœ… | â­â­â­ |

**æ¨è**: é˜¿é‡Œäº‘OSS (å›½å†…) + Cloudflare R2 (å›½é™…)

#### 3.3 æ•°æ®åº“

**æ–¹æ¡ˆå¯¹æ¯”**:

| ç±»å‹ | äº§å“ | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|------|------|----------|--------|
| å…³ç³»å‹ | PostgreSQL | å¤æ‚æŸ¥è¯¢ã€äº‹åŠ¡ | â­â­â­â­ |
| æ–‡æ¡£å‹ | MongoDB | çµæ´»schema | â­â­â­â­â­ |
| äº‘æœåŠ¡ | Supabase | å¿«é€Ÿå¼€å‘ | â­â­â­â­â­ |

**æ¨è**: MongoDB Atlas (å…è´¹512MB) + Supabase (PostgreSQL)

#### 3.4 å®¢æˆ·ç«¯æ”¹é€ 

**ä¿®æ”¹ApiProfileService**:
```dart
class ApiProfileService implements ProfileService {
  final String baseUrl;
  final String token; // JWTè®¤è¯

  @override
  Future<ProfileSyncResult> syncProfile(Pet pet) async {
    final response = await http.post(
      Uri.parse('$baseUrl/api/v1/pets/profile'),
      headers: {
        'Authorization': 'Bearer $token',
        'Content-Type': 'application/json',
      },
      body: jsonEncode(pet.toJson()),
    );

    if (response.statusCode == 200) {
      return ProfileSyncResult(
        success: true,
        message: 'åŒæ­¥æˆåŠŸ',
        syncedAt: DateTime.now(),
      );
    }
    throw Exception('åŒæ­¥å¤±è´¥: ${response.body}');
  }

  @override
  Future<String> uploadProfilePhoto(File photo) async {
    var request = http.MultipartRequest(
      'POST',
      Uri.parse('$baseUrl/api/v1/upload/profile-photo'),
    );

    request.headers['Authorization'] = 'Bearer $token';
    request.files.add(await http.MultipartFile.fromPath(
      'photo',
      photo.path,
    ));

    final response = await request.send();
    final responseData = await response.stream.bytesToString();
    final json = jsonDecode(responseData);

    return json['data']['url']; // OSS URL
  }
}
```

---

### Phase 4: æ•°æ®è¿ç§»ç­–ç•¥

**æœ¬åœ°æ•°æ®ä¸Šä¼ **:
```dart
class DataMigrationService {
  /// é¦–æ¬¡ç™»å½•æ—¶ä¸Šä¼ æ‰€æœ‰æœ¬åœ°æ•°æ®
  Future<void> uploadLocalData() async {
    // 1. ä¸Šä¼ å® ç‰©ä¿¡æ¯
    final pet = await PetRepository().getCurrentPet();
    if (pet != null) {
      await ApiProfileService().syncProfile(pet);
    }

    // 2. ä¸Šä¼ æ‰€æœ‰ç…§ç‰‡
    final photos = await AppPhotoRepository().getAllPhotos();
    for (final photo in photos) {
      final file = File(photo.localPath);
      if (await file.exists()) {
        final ossUrl = await ApiPhotoService().uploadPhoto(file);
        // æ›´æ–°æœ¬åœ°è®°å½•ï¼Œæ ‡è®°å·²ä¸Šä¼ 
        await AppPhotoRepository().updatePhotoUrl(photo.id, ossUrl);
      }
    }

    // 3. ä¸Šä¼ æ—¥è®°
    final diaries = await DiaryRepository().getAllEntries();
    for (final diary in diaries) {
      await ApiDiaryService().syncDiary(diary);
    }
  }
}
```

---

## æˆæœ¬ä¼°ç®—

### åˆæœŸï¼ˆ1000ç”¨æˆ·ï¼‰

**åŸºç¡€è®¾æ–½**:
- äº‘æœåŠ¡å™¨: Â¥50/æœˆ (1æ ¸2G)
- OSSå­˜å‚¨: Â¥10/æœˆ (100GB)
- æ•°æ®åº“: å…è´¹ (MongoDB Atlas)
- CDNæµé‡: Â¥20/æœˆ (100GB)
- **æ€»è®¡: Â¥80/æœˆ**

### ä¸­æœŸï¼ˆ1ä¸‡ç”¨æˆ·ï¼‰

- äº‘æœåŠ¡å™¨: Â¥200/æœˆ (2æ ¸4G)
- OSSå­˜å‚¨: Â¥50/æœˆ (500GB)
- æ•°æ®åº“: Â¥100/æœˆ
- CDNæµé‡: Â¥100/æœˆ (500GB)
- **æ€»è®¡: Â¥450/æœˆ**

---

## æ¨èå®æ–½è·¯å¾„

### ç«‹å³å¯åšï¼ˆæœ¬å‘¨ï¼‰â­â­â­

1. **æ­å»ºæœ¬åœ°ExpressæœåŠ¡å™¨**
   - å®ç°ç…§ç‰‡ä¸Šä¼ API
   - å®ç°ProfileåŒæ­¥API
   - æµ‹è¯•å®Œæ•´æµç¨‹

2. **ä¿®å¤ç°æœ‰æ•°æ®é—®é¢˜**
   - æ¸…ç†æ—§çš„ä¸´æ—¶è·¯å¾„æ•°æ®
   - éªŒè¯æŒä¹…åŒ–å­˜å‚¨é€»è¾‘

### çŸ­æœŸç›®æ ‡ï¼ˆ2å‘¨å†…ï¼‰â­â­â­â­

1. **é›†æˆäº‘å­˜å‚¨**
   - æ³¨å†Œé˜¿é‡Œäº‘OSS/ä¸ƒç‰›äº‘
   - å®ç°ç…§ç‰‡ä¸Šä¼ åˆ°OSS
   - CDNåŠ é€Ÿé…ç½®

2. **å®ç°æ•°æ®åŒæ­¥**
   - æœ¬åœ°ä¼˜å…ˆå†™å…¥
   - åå°å¼‚æ­¥ä¸Šä¼ 
   - å†²çªè§£å†³ç­–ç•¥

### ä¸­æœŸç›®æ ‡ï¼ˆ1ä¸ªæœˆï¼‰â­â­â­â­â­

1. **ç”¨æˆ·è´¦å·ç³»ç»Ÿ**
   - é‚®ç®±æ³¨å†Œ/ç™»å½•
   - JWTè®¤è¯
   - æ•°æ®éš”ç¦»

2. **ç”Ÿäº§éƒ¨ç½²**
   - æœåŠ¡å™¨éƒ¨ç½²
   - åŸŸåé…ç½®
   - HTTPSè¯ä¹¦
   - ç›‘æ§å‘Šè­¦

---

## å®‰å…¨æ£€æŸ¥æ¸…å•

### å¿…é¡»å®ç° ğŸ”’

- [ ] HTTPSåŠ å¯†ä¼ è¾“
- [ ] JWT Tokenè®¤è¯
- [ ] ç…§ç‰‡è®¿é—®æƒé™æ§åˆ¶
- [ ] æ•æ„Ÿæ•°æ®åŠ å¯†ï¼ˆå¯†ç ã€æ—¥è®°ï¼‰
- [ ] SQLæ³¨å…¥é˜²æŠ¤
- [ ] æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
- [ ] é¢‘ç‡é™åˆ¶ï¼ˆé˜²åˆ·ï¼‰
- [ ] æ—¥å¿—è„±æ•

### æ¨èå®ç°

- [ ] åŒå› ç´ è®¤è¯
- [ ] è®¾å¤‡æŒ‡çº¹
- [ ] å¼‚å¸¸ç™»å½•æ£€æµ‹
- [ ] æ•°æ®å¤‡ä»½ç­–ç•¥
- [ ] ç¾éš¾æ¢å¤é¢„æ¡ˆ

---

## æ€»ç»“

### å½“å‰æ–¹æ¡ˆè¯„çº§

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| åŠŸèƒ½å®Œæ•´æ€§ | â­â­â­â­ | æ ¸å¿ƒåŠŸèƒ½å®Œå–„ |
| ç¦»çº¿å¯ç”¨æ€§ | â­â­â­â­â­ | å®Œå…¨ç¦»çº¿å·¥ä½œ |
| æ•°æ®æŒä¹…æ€§ | â­â­ | ä»…æœ¬åœ°ï¼Œæœ‰ä¸¢å¤±é£é™© |
| å¤šè®¾å¤‡åŒæ­¥ | â­ | ä¸æ”¯æŒ |
| ç”Ÿäº§å°±ç»ªåº¦ | â­â­ | éœ€è¦äº‘æœåŠ¡ |

### æ¨èç­”æ¡ˆ

**å¯ä»¥å…ˆä¸Šçº¿å—?**
- âœ… å¯ä»¥ä½œä¸º**ç¦»çº¿ç‰ˆMVP**æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
- âœ… é€‚åˆå°èŒƒå›´å†…æµ‹ï¼ˆ<50äººï¼‰
- âŒ **ä¸å»ºè®®æ­£å¼å‘å¸ƒåˆ°App Store**

**åŸå› **:
1. ç”¨æˆ·æ•°æ®æ— å¤‡ä»½ï¼Œä½“éªŒå·®
2. æ— æ³•è·¨è®¾å¤‡ä½¿ç”¨
3. ç¼ºå°‘è´¦å·ç³»ç»Ÿï¼Œæ— æ³•åŒºåˆ†ç”¨æˆ·
4. Appå®¡æ ¸å¯èƒ½è¦æ±‚éšç§æ”¿ç­–å’Œæ•°æ®ç®¡ç†

**å»ºè®®è·¯å¾„**:
1. æœ¬å‘¨: æ­å»ºæœ¬åœ°ExpressæœåŠ¡å™¨æµ‹è¯•
2. 2å‘¨å†…: é›†æˆäº‘å­˜å‚¨ï¼ˆé˜¿é‡Œäº‘OSSï¼‰
3. 1ä¸ªæœˆ: å®Œæˆç”¨æˆ·ç³»ç»Ÿå’Œæ•°æ®åŒæ­¥
4. ç„¶å: æ­£å¼å‘å¸ƒ
