# å®¢æˆ·ç«¯è°ƒè¯•æ—¥å¿—æŒ‡å—

## ğŸ“‹ å·²æ·»åŠ çš„è°ƒè¯•æ—¥å¿—

### 1. HomeViewModel - å¯åŠ¨å’Œé…ç½®æ£€æŸ¥

**ä½ç½®**: `lib/presentation/screens/home/home_viewmodel.dart:58-79`

**æ—¥å¿—æ ‡è®°**: `ğŸ”§ [HomeLoad]`

```dart
ğŸ”§ [HomeLoad] ==================
ğŸ”§ [HomeLoad] Token: <device-id or (æœªè®¾ç½®)>
ğŸ”§ [HomeLoad] Base URL: http://192.168.3.129:3000
ğŸ”§ [HomeLoad] ==================
```

**ç”¨é€”**: éªŒè¯ API é…ç½®æ˜¯å¦æ­£ç¡®

---

### 2. HomeViewModel - æ‰«ææµç¨‹

**ä½ç½®**: `lib/presentation/screens/home/home_viewmodel.dart:96-225`

**æ—¥å¿—æ ‡è®°**: `ğŸ“· [HomeScan]`

#### 2.1 æ‰«æå¼€å§‹
```dart
ğŸ“· [HomeScan] ==================
ğŸ“· [HomeScan] å¼€å§‹æ‰«ææµç¨‹
ğŸ“· [HomeScan] Pet ID: <pet-id>
ğŸ“· [HomeScan] ==================
ğŸ“· [HomeScan] æƒé™çŠ¶æ€: <status>
```

#### 2.2 æ‰«æè§¦å‘
```dart
ğŸ“· [HomeScan] è§¦å‘æ‰«æ...
âœ… [HomeScan] æ‰«æå·²è§¦å‘ï¼Œç­‰å¾…ç»“æœ...
```

#### 2.3 æ‰«æç»“æœ
```dart
ğŸ“· [HomeScan] æ‰«æåˆ°: <assetId> (Pet: <petId>)
âœ… [HomeScan] æ‰«æå®Œæˆ: å‘ç° N å¼ ç…§ç‰‡
```

#### 2.4 èšåˆä¸Šä¼ 
```dart
ğŸ“Š [HomeScan] ==================
ğŸ“Š [HomeScan] å¼€å§‹ä¸Šä¼ æµç¨‹
ğŸ“Š [HomeScan] æ”¶é›†åˆ° N å¼ ç…§ç‰‡
ğŸ“Š [HomeScan] æŒ‰å¤©èšåˆ: N å¤©
   2026-02-04: 3 å¼ 
   2026-02-03: 2 å¼ 
```

#### 2.5 ä¸Šä¼ è¿›åº¦
```dart
ğŸ“¤ [HomeScan] ==================
ğŸ“¤ [HomeScan] ä¸Šä¼ ç¬¬ 1/2 å¤©
   æ—¥æœŸ: 2026-02-04
   ç…§ç‰‡æ•°: 3
âœ… [HomeScan] 2026-02-04 ä¸Šä¼ å®Œæˆ: 3/3 å¼ 
```

#### 2.6 å®Œæˆ
```dart
ğŸ‰ [HomeScan] ==================
ğŸ‰ [HomeScan] ä¸Šä¼ å®Œæˆ!
ğŸ‰ [HomeScan] æ€»è®¡: 5 å¼ ç…§ç‰‡
ğŸ‰ [HomeScan] ==================
```

#### 2.7 é”™è¯¯æƒ…å†µ
```dart
âŒ [HomeScan] æƒé™ä¸è¶³ï¼Œè·³è¿‡æ‰«æ
âŒ [HomeScan] æ‰«æè§¦å‘å¤±è´¥
âš ï¸ [HomeScan] æ‰«æè¶…æ—¶ï¼ˆ5 åˆ†é’Ÿï¼‰
â„¹ï¸ [HomeScan] æœªå‘ç°å® ç‰©ç…§ç‰‡
âŒ [HomeScan] æ‰«æç®¡çº¿é”™è¯¯: <error>
```

---

### 3. ScanUploadService - å‹ç¼©å’Œä¸Šä¼ 

**ä½ç½®**: `lib/domain/services/scan_upload_service.dart:45-79`

**æ—¥å¿—æ ‡è®°**: `ğŸ”§ [ScanUpload]`

```dart
ğŸ”§ [ScanUpload] å¤„ç† 1/3: asset-001
   ğŸ—œï¸  å‹ç¼©ä¸­...
   âœ… å·²å‹ç¼©
   ğŸ“¤ ä¸Šä¼ ä¸­...
   âœ… ä¸Šä¼ æˆåŠŸ: asset-001 (2026-02-04)
   âš ï¸  æ£€æµ‹åˆ°é‡å¤

ğŸ”§ [ScanUpload] å¤„ç† 2/3: asset-002
   â„¹ï¸  æ— éœ€å‹ç¼©
   ğŸ“¤ ä¸Šä¼ ä¸­...
   âŒ ä¸Šä¼ å¤±è´¥: asset-002 - ç½‘ç»œè¿æ¥å¤±è´¥
```

---

### 4. ApiClient - HTTP è¯·æ±‚

**ä½ç½®**: `lib/core/network/api_client.dart:79-190`

**æ—¥å¿—æ ‡è®°**: `ğŸŒ [ApiClient]`

#### 4.1 ä¸Šä¼ è¯·æ±‚
```dart
ğŸŒ UPLOAD http://192.168.3.129:3000/api/chongyu/image/list/upload
   æ–‡ä»¶æ•°: 1
   å­—æ®µæ•°: 3
   petId: test-pet-001
   date: 2026-02-04
   è¶…æ—¶: 30s
```

#### 4.2 å“åº”æˆåŠŸ
```dart
ğŸ“¥ Response [200]
   Body: {"success":true,"data":{"uploaded":1,"duplicates":0}}
âœ… API è°ƒç”¨æˆåŠŸ
```

#### 4.3 å“åº”å¤±è´¥
```dart
ğŸ“¥ Response [401]
   Body: {"success":false,"error":{"message":"æœªæˆæƒ","code":401}}
âŒ 401 æœªæˆæƒ
âŒ API è¿”å›å¤±è´¥: æœªæˆæƒ
```

#### 4.4 ç½‘ç»œé”™è¯¯
```dart
âŒ ç½‘ç»œè¿æ¥å¤±è´¥: <error>
â±ï¸ ä¸Šä¼ è¶…æ—¶
âŒ ä¸Šä¼ å¼‚å¸¸: <error>
âŒ JSON è§£æå¤±è´¥: <error>
```

---

## ğŸ” å¦‚ä½•ä½¿ç”¨æ—¥å¿—è°ƒè¯•

### 1. æŸ¥çœ‹å®Œæ•´æ—¥å¿—

åœ¨ç»ˆç«¯è¿è¡Œ App å¹¶æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š

```bash
# è¿è¡Œ App å¹¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
flutter run -v

# æˆ–è€…åœ¨ Xcode/Android Studio ä¸­æŸ¥çœ‹ Console
```

### 2. è¿‡æ»¤ç‰¹å®šæ—¥å¿—

ä½¿ç”¨ grep è¿‡æ»¤ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰æ‰«æç›¸å…³æ—¥å¿—
flutter run | grep "HomeScan"

# æŸ¥çœ‹æ‰€æœ‰ API è¯·æ±‚
flutter run | grep "ApiClient"

# æŸ¥çœ‹æ‰€æœ‰é”™è¯¯
flutter run | grep "âŒ"

# æŸ¥çœ‹æ‰€æœ‰é…ç½®ä¿¡æ¯
flutter run | grep "HomeLoad"
```

### 3. ä½¿ç”¨ emoji å¿«é€Ÿè¯†åˆ«

| Emoji | å«ä¹‰ |
|-------|------|
| ğŸ”§ | é…ç½®/å¤„ç†ä¿¡æ¯ |
| ğŸ“· | æ‰«ææµç¨‹ |
| ğŸ“Š | æ•°æ®èšåˆ |
| ğŸ“¤ | ä¸Šä¼ æµç¨‹ |
| ğŸ‰ | å®Œæˆ/æˆåŠŸ |
| ğŸŒ | ç½‘ç»œè¯·æ±‚ |
| ğŸ“¥ | ç½‘ç»œå“åº” |
| âœ… | æˆåŠŸ |
| âŒ | é”™è¯¯ |
| âš ï¸ | è­¦å‘Š |
| â„¹ï¸ | ä¿¡æ¯ |
| ğŸ—œï¸ | å‹ç¼©æ“ä½œ |

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: æœªçœ‹åˆ°æ‰«ææ—¥å¿—

**å¯èƒ½åŸå› **:
1. æƒé™æœªæˆäºˆ
2. æ²¡æœ‰å® ç‰© profile
3. æ‰«ææµç¨‹æœªè§¦å‘

**æŸ¥æ‰¾æ—¥å¿—**:
```
ğŸ“· [HomeScan] No pet, skip scan
âŒ [HomeScan] æƒé™ä¸è¶³ï¼Œè·³è¿‡æ‰«æ
```

**è§£å†³**:
- åˆ›å»ºå® ç‰© profile
- æˆäºˆç…§ç‰‡æƒé™

---

### é—®é¢˜ 2: Token æœªè®¾ç½®

**æ—¥å¿—ç‰¹å¾**:
```
ğŸ”§ [HomeLoad] Token: (æœªè®¾ç½®)
ğŸ“¥ Response [401]
âŒ 401 æœªæˆæƒ
```

**è§£å†³**:
- æ£€æŸ¥ `main.dart:20` æ˜¯å¦è®¾ç½® token
- æ£€æŸ¥ `profile_setup_viewmodel.dart:192` æ˜¯å¦è®¾ç½® token

---

### é—®é¢˜ 3: ç½‘ç»œè¿æ¥å¤±è´¥

**æ—¥å¿—ç‰¹å¾**:
```
âŒ ç½‘ç»œè¿æ¥å¤±è´¥: <error>
```

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥ Base URL æ˜¯å¦æ­£ç¡®
```
ğŸ”§ [HomeLoad] Base URL: http://192.168.3.129:3000
```

2. æ£€æŸ¥ mock server æ˜¯å¦è¿è¡Œ
```bash
curl http://192.168.3.129:3000/
```

3. æ£€æŸ¥è®¾å¤‡æ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘

---

### é—®é¢˜ 4: ç…§ç‰‡ä¸Šä¼ å¤±è´¥

**æ—¥å¿—ç‰¹å¾**:
```
ğŸ“¤ ä¸Šä¼ ä¸­...
âŒ ä¸Šä¼ å¤±è´¥: asset-002 - <error>
```

**æ’æŸ¥**:
- æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯
- æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- æ£€æŸ¥æœåŠ¡ç«¯æ—¥å¿—

---

### é—®é¢˜ 5: æ‰«æå®Œæˆä½†æ— ç…§ç‰‡

**æ—¥å¿—ç‰¹å¾**:
```
âœ… [HomeScan] æ‰«æå®Œæˆ: å‘ç° 0 å¼ ç…§ç‰‡
â„¹ï¸ [HomeScan] æœªå‘ç°å® ç‰©ç…§ç‰‡
```

**åŸå› **:
- ç›¸å†Œä¸­ç¡®å®æ²¡æœ‰å® ç‰©ç…§ç‰‡
- Vision æ¡†æ¶æœªè¯†åˆ«å‡ºçŒ«/ç‹—

---

### é—®é¢˜ 6: ä¸Šä¼ æˆåŠŸä½†æ—¥è®°æ— ç…§ç‰‡

**æ—¥å¿—éªŒè¯**:
```
âœ… [HomeScan] 2026-02-04 ä¸Šä¼ å®Œæˆ: 3/3 å¼ 
ğŸ“¥ Response [200]
âœ… API è°ƒç”¨æˆåŠŸ
```

**æœåŠ¡ç«¯éªŒè¯**:
```bash
# æŸ¥çœ‹ pet_photos é›†åˆ
cat mock-server/db.json | jq '.pet_photos'

# æŸ¥çœ‹æ—¥è®° imageList
curl -H "token: test123" \
  "http://192.168.3.129:3000/api/chongyu/pet/detail?petId=<pet-id>&date=2026-02-04"
```

---

## ğŸ“Š å®Œæ•´æµç¨‹æ—¥å¿—ç¤ºä¾‹

### æˆåŠŸæµç¨‹

```
ğŸ”§ [HomeLoad] ==================
ğŸ”§ [HomeLoad] Token: test-pet-001
ğŸ”§ [HomeLoad] Base URL: http://192.168.3.129:3000
ğŸ”§ [HomeLoad] ==================

ğŸ“· [HomeScan] ==================
ğŸ“· [HomeScan] å¼€å§‹æ‰«ææµç¨‹
ğŸ“· [HomeScan] Pet ID: test-pet-001
ğŸ“· [HomeScan] ==================
ğŸ“· [HomeScan] æƒé™çŠ¶æ€: authorized
ğŸ“· [HomeScan] è§¦å‘æ‰«æ...
âœ… [HomeScan] æ‰«æå·²è§¦å‘ï¼Œç­‰å¾…ç»“æœ...

ğŸ“· [HomeScan] æ‰«æåˆ°: asset-001 (Pet: test-pet-001)
ğŸ“· [HomeScan] æ‰«æåˆ°: asset-002 (Pet: test-pet-001)
ğŸ“· [HomeScan] æ‰«æåˆ°: asset-003 (Pet: test-pet-001)
âœ… [HomeScan] æ‰«æå®Œæˆ: å‘ç° 3 å¼ ç…§ç‰‡

ğŸ“Š [HomeScan] ==================
ğŸ“Š [HomeScan] å¼€å§‹ä¸Šä¼ æµç¨‹
ğŸ“Š [HomeScan] æ”¶é›†åˆ° 3 å¼ ç…§ç‰‡
ğŸ“Š [HomeScan] æŒ‰å¤©èšåˆ: 1 å¤©
   2026-02-04: 3 å¼ 

ğŸ“¤ [HomeScan] ==================
ğŸ“¤ [HomeScan] ä¸Šä¼ ç¬¬ 1/1 å¤©
   æ—¥æœŸ: 2026-02-04
   ç…§ç‰‡æ•°: 3

ğŸ”§ [ScanUpload] å¤„ç† 1/3: asset-001
   ğŸ—œï¸  å‹ç¼©ä¸­...
   âœ… å·²å‹ç¼©
   ğŸ“¤ ä¸Šä¼ ä¸­...

ğŸŒ UPLOAD http://192.168.3.129:3000/api/chongyu/image/list/upload
   æ–‡ä»¶æ•°: 1
   å­—æ®µæ•°: 3
   petId: test-pet-001
   date: 2026-02-04
   è¶…æ—¶: 30s

ğŸ“¥ Response [200]
   Body: {"success":true,"data":{"uploaded":1,"duplicates":0}}
âœ… API è°ƒç”¨æˆåŠŸ

   âœ… ä¸Šä¼ æˆåŠŸ: asset-001 (2026-02-04)

ğŸ”§ [ScanUpload] å¤„ç† 2/3: asset-002
   ğŸ—œï¸  å‹ç¼©ä¸­...
   âœ… å·²å‹ç¼©
   ğŸ“¤ ä¸Šä¼ ä¸­...
   âœ… ä¸Šä¼ æˆåŠŸ: asset-002 (2026-02-04)

ğŸ”§ [ScanUpload] å¤„ç† 3/3: asset-003
   ğŸ—œï¸  å‹ç¼©ä¸­...
   âœ… å·²å‹ç¼©
   ğŸ“¤ ä¸Šä¼ ä¸­...
   âœ… ä¸Šä¼ æˆåŠŸ: asset-003 (2026-02-04)

âœ… [HomeScan] 2026-02-04 ä¸Šä¼ å®Œæˆ: 3/3 å¼ 

ğŸ‰ [HomeScan] ==================
ğŸ‰ [HomeScan] ä¸Šä¼ å®Œæˆ!
ğŸ‰ [HomeScan] æ€»è®¡: 3 å¼ ç…§ç‰‡
ğŸ‰ [HomeScan] ==================
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- **æœåŠ¡ç«¯æµ‹è¯•**: `mock-server/CONNECTION_TEST_RESULT.md`
- **å®Œæ•´æµç¨‹**: `DIARY_FLOW_CHECK_SUMMARY.md`
- **API æŒ‡å—**: `API_TEST_GUIDE.md`
